---
title: How to deploy a production-grade bastion host on AWS
categories: Networking
image:
excerpt: Learn how to deploy a secure bastion host for your production system on AWS.
tags: ["aws", "networking", "terraform"]
cloud: ["aws"]
redirect_from: /static/guides/networking/how-to-deploy-production-grade-bastion-host-aws/
---
:page-type: guide
:page-layout: post

:toc:
:toc-placement!:

// GitHub specific settings. See https://gist.github.com/dcode/0cfbf2699a1fe9b46ff04c41721dda74 for details.
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
toc::[]
endif::[]

== Intro

This guide will walk you through the process of configuring a production-grade bastion host on AWS.

If you were following the https://gruntwork.io/guides/networking/how-to-deploy-production-grade-vpc-aws[Gruntwork guide on how to deploy a production grade VPC on AWS], then you probably came across https://gruntwork.io/guides/networking/how-to-deploy-production-grade-vpc-aws/#bastion_host[the section talking about bastion hosts].

When deploying your infrastructure in AWS or any of the other main cloud providers, it is considered secure to keep your data stores and application servers in a private network. While this might depend on your system architecture, most likely, you would want to keep them secure and only allow access from trusted sources. This means you will need some way of determining if the access and traffic to your private network is to be trusted or not. There's many ways to achieve that, and one of them is to simply restrict access to only come from the so-called bastion server.

Typically, as a network administrator, or as a developer with the privileges to set up such servers and configure them, you would want to set up a bastion host yourself. This would allow you to examine the system logs and configure what parts of the network that server can reach, where it lives in your system, when it's online and offline, and of course who can access it.

A bastion host sits in the public network, and is accessible directly from the Internet, or the whitelisted IP addresses in its configuration. Once connected to it, usually over SSH, the bastion host enables you to access private network resources such as EC2 and RDS instances, or any other resources also placed in the private subnet.

=== What is a bastion host?

The word "bastion" was originally coined as a term in network security in 1990 by Marcus J. Ranum. Many centuries before that, the name bastion was used to describe a projecting part of a fortification, designed in such a way to offer maximum defenses from multiple angles.

In the technical world of infrastructure, a _bastion host_ is a single, highly locked-down server that allows you to connect your private network to the public Internet over SSH or VPN.
Once connected to a bastion host, you will be "in the network", assuming the IP of that bastion host. This way you'll be able to access all
resources available to that network that the bastion host is connected to. As defined in AWS's security blog https://aws.amazon.com/blogs/security/how-to-record-ssh-sessions-established-through-a-bastion-host/[here], within the context of AWS, a bastion host is meant to provide access  to a private network from an external one (e.g. the Internet) and minimize the risk of penetration to the resources launched in a private subnet of your Amazon Virtual Private Cloud (VPC).

=== What you'll learn in this guide

This guide consists of four main sections:

<<core_concepts>>::
  An overview of the core concepts you need to understand for bastion hosts and how and when to use them.

<<production_grade_design>>::
  An overview of how to configure a secure server to serve as a bastion host in a production environment. To get a
  sense of what production-grade means, check out link:/guides/foundations/how-to-use-gruntwork-infrastructure-as-code-library#production_grade_infra_checklist[The production-grade infrastructure checklist].

<<deployment_walkthrough>>::
  A step-by-step guide to deploying a production-grade bastion host in AWS using code from the Gruntwork Infrastructure as Code Library.

<<next_steps>>::
  What to do once your bastion host is configured and set up.

Feel free to read the guide from start to finish or skip around to whatever part interests you!

[[core_concepts]]
== Core concepts

[[bastion_host_overview]]
=== Bastion host overview
image::../assets/img/guides/bastion/bastion.png[]
Here are the key points to define bastion hosts:

  - They provide entry into your private subnet.
  - The bastion host will need to be exposed to the external world, so it needs a public IP address. This also means that it needs to be placed within the boundaries of the public subnet.
  - To communicate with the bastion host, users will need SSH or VPN access set up. These are the most common ways a bastion server can be set up.

[[why_bastion]]
=== Why use a bastion host?
Your team will need some way of accessing private services such as the data stores, the application servers, and so on. If you open these up to be publicly accessible so your team can access them, that would expose your system to much bigger threats. Therefore it is consideted best practice to not expose internal services, but instead get to them via a bastion host.

This way you would have to prioritise securing the bastion server, instead of split your effort between securing mutiple servers (if all application servers and data stores were exposed to the Internet).

[[how_bastion_with_ssh]]
=== How SSH access works with a bastion host?

[[bastion_alternatives]]
== What alternatives are there to using a bastion host?
Some of the alternatives to using a bastion host that will also work with resources in private subnets include
https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html[EC2 Instance Connect],
which can allow you to SSH to EC2 Instances via a browser-based SSH client in the Amazon EC2 Console, and
https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager.html[AWS Systems Manager Sessions], which
allow you to manage and connect to EC2 Instances via a custom protocol managed by AWS.

[[deployment_walkthrough]]
== Deployment walkthrough

Let's now walk through how to deploy a production-grade server that will be our bastion host, fully defined and managed as code, using the Gruntwork Infrastructure as Code Library.

//TODO add your code

[[pre_requisites]]
=== Pre-requisites

This walkthrough has the following pre-requisites:

Gruntwork Infrastructure as Code Library::
  This guide uses code from the https://gruntwork.io/infrastructure-as-code-library/[Gruntwork Infrastructure as Code Library], as it
  implements most of the production-grade design for you out of the box. Make sure to read
  link:/guides/foundations/how-to-use-gruntwork-infrastructure-as-code-library[How to use the Gruntwork Infrastructure as Code Library].
+
[.exceptional]
IMPORTANT: You must be a [js-subscribe-cta]#Gruntwork subscriber# to access the Gruntwork Infrastructure as Code Library.

Terraform::
  This guide uses https://www.terraform.io/[Terraform] to define and manage all the infrastructure as code. If you're
  not familiar with Terraform, check out https://blog.gruntwork.io/a-comprehensive-guide-to-terraform-b3d32832baca[A
  Comprehensive Guide to Terraform], https://training.gruntwork.io/p/terraform[A Crash Course on Terraform], and
  link:/guides/foundations/how-to-use-gruntwork-infrastructure-as-code-library[How to Use the Gruntwork Infrastructure as Code Library]

AWS accounts::
  This guide deploys infrastructure into one or more AWS accounts. Check out the
  link:/guides/foundations/how-to-configure-production-grade-aws-account-structure[Production Grade AWS Account Structure] guide for instructions.
  You will also need to be able to authenticate to these accounts on the CLI: check out
  https://blog.gruntwork.io/a-comprehensive-guide-to-authenticating-to-aws-on-the-command-line-63656a686799[A Comprehensive Guide to Authenticating to AWS on the Command Line]
  for instructions.

[[deploy_bastion_server]]
=== Deploy a bastion server

For this part we will be deploying one of our core module https://github.com/gruntwork-io/terraform-aws-server/blob/master/modules/single-server[`single-server module`].
