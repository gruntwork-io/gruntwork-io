---
title: Route 53 (private) Service Migration Guide
categories: Upgrades
image: /assets/img/guides/refresh_icon.png
excerpt: Learn how to update your v1 Reference Architecture to use the Gruntwork Service Catalog.
tags: ["aws", "terraform", "terragrunt"]
cloud: ["aws"]
redirect_from: /static/guides/upgrades/how-to-update-your-ref-arch/
---
:page-type: guide
:page-layout: post

:toc:
:toc-placement!:

// GitHub specific settings. See https://gist.github.com/dcode/0cfbf2699a1fe9b46ff04c41721dda74 for details.
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
toc::[]
endif::[]

== Route 53 (private) Service Migration Guide

Follow this guide to update the route53-private service to the Service Catalog.

=== Estimated Time to Migrate: 5-10 minutes per environment

=== New Required Inputs

Configure these new inputs to migrate to the Service Catalog version of the module. They are now required.

* `private_zones`__:__ For route53-private, you must define the domain in a `private_zones` map. The VPC ID should be
retrieved with a `dependency` block. For a backward compatible update, use the following map configuration:

....
private_zones = {
    "example.com" = {
      vpc_id = dependency.vpc.outputs.vpc_id
      comment = "Managed by Terraform"
      tags = {}
      force_destroy = false
    }
}
....

=== Removed Inputs

Remove the following inputs as they are not present in the Service Catalog version of the module:

* `internal_services_domain_name`: This input in route53-private has been removed and replaced with a new input,
`private_zones`, described above.

=== Output Changes

Update downstream dependency references to use the new names of these outputs, which were renamed in the Service Catalog
version of the module.

* `internal_services_domain_name`: This output in route53-private has been removed and replaced with a new output,
`private_domain_names`, which is a list of domain names. If your `private_zones` map contains only one domain, this
output will have only one element.
* `internal_services_hosted_zone_id`: This output in route53-private has been removed and replaced with a new output,
`private_zones_ids`, which is a list of zone IDs. If your `private_zones` map contains only one domain, this output will
have only one element.
* `internal_services_name_servers`: This output in route53-private has been removed and replaced with a new output,
`private_zones_name_servers`, which is a list of lists, where each element of the list is a list of name servers for a
domain in the list of `private_domain_names`. If your `private_zones` map contains only one domain, this output will
have only one element.

=== State Migration Script

Run the link:./scripts/migrate_route53_private.sh[provided migration script] to migrate the state in a backward compatible way.

=== Breaking Changes

* This change is fully backward compatible. You will notice the creation of a `null_resource` in the plan and apply.
This can be safely ignored.
